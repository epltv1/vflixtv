<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Event Player</title>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #1C2526;
      color: #FFFFFF;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .player-container {
      width: 100%;
      max-width: 800px;
      margin-bottom: 20px;
    }

    .plyr {
      width: 100%;
      height: auto;
      aspect-ratio: 16 / 9;
    }

    .stream-links-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .stream-link {
      padding: 10px 20px;
      background: #FFD700;
      color: #1C2526;
      text-decoration: none;
      border-radius: 5px;
      font-size: 16px;
      transition: background 0.3s;
    }

    .stream-link:hover {
      background: #D4A017;
    }

    .suggestions-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      width: 100%;
    }

    .match-card {
      background: #1C2526;
      border: 2px solid #FFD700;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      position: relative;
      font-family: 'Georgia', serif;
    }

    .match-card:hover {
      transform: translateY(-5px) rotate(1deg);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    }

    .match-header {
      background: #2B2F30;
      color: #FFD700;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .match-content {
      background: #2B2F30;
      padding: 15px;
      text-align: center;
    }

    .team-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }

    .team {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      max-width: 40%;
    }

    .team img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      border: 2px solid #FFD700;
      border-radius: 50%;
    }

    .team span {
      font-size: 14px;
      color: #FFFFFF;
      font-weight: bold;
    }

    .league-logo {
      width: 50px;
      height: 50px;
      object-fit: contain;
      border: 3px solid #FFD700;
      border-radius: 50%;
      background: #FFFFFF;
      padding: 4px;
      margin: 0 auto 10px;
    }

    .timer {
      font-size: 13px;
      color: #FFFFFF;
      font-weight: bold;
      margin: 8px 0;
      min-height: 18px;
    }

    .live-animation {
      display: inline-block;
      color: #FF0000;
      font-weight: bold;
      font-size: 14px;
      text-shadow: 0 0 8px #FFD700;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    .status {
      text-align: center;
      color: #00FF00;
      font-weight: bold;
      font-size: 13px;
      margin: 8px 0;
    }

    .links-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 10px;
    }

    .no-suggestions {
      text-align: center;
      color: #FFFFFF;
      opacity: 0.7;
      font-size: 16px;
      margin: 20px 0;
    }

    /* Responsive adjustments for non-card elements */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .player-container {
        max-width: 100%;
      }

      .stream-link {
        padding: 8px 15px;
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 10px;
      }

      .stream-link {
        padding: 6px 12px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <nav style="background: #2B2F30; padding: 10px; text-align: center;">
    <a href="/" style="color: #FFD700; margin: 0 15px; text-decoration: none;">Home</a>
    <a href="/events" style="color: #FFD700; margin: 0 15px; text-decoration: none;">Live Events</a>
    <a href="/channels" style="color: #FFD700; margin: 0 15px; text-decoration: none;">Sports Channels</a>
  </nav>

  <div class="container">
    <div class="player-container">
      <video id="player" class="plyr" controls>
        <source src="" type="application/x-mpegURL">
      </video>
    </div>
    <div class="stream-links-container" id="streamLinksContainer"></div>
    <div class="suggestions-container" id="suggestionsContainer">
      <h2 style="color: #FFD700; width: 100%; text-align: center;">Suggested Matches</h2>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
  <script type="module">
    // Import matches from separate file
    import matches from '/data/matches.js';

    // Stream URL mappings for go: URLs (replace with real URLs)
    const STREAM_URLS = {
      'go:skymain': 'https://example.com/skymain.m3u8',
      'go:opt1': 'https://example.com/optus1.m3u8',
      'go:opt3': 'https://example.com/optus3.m3u8',
      'go:skyf1': 'https://example.com/skyf1.m3u8',
      'go:laligafhd': 'https://example.com/laligafhd.m3u8',
      'go:sliga': 'https://example.com/sliga.m3u8',
      'go:motogpstream': 'https://example.com/motogpstream.m3u8',
      'go:f1stream': 'https://example.com/f1stream.m3u8',
      'go:smackdownstream': 'https://example.com/smackdownstream.m3u8',
      'go:willow2': 'https://example.com/willow2.m3u8'
    };

    // Initialize Plyr player with hls.js
    const video = document.getElementById('player');
    const streamUrl = sessionStorage.getItem('selectedStream') || 'https://flixtvlive.vercel.app/tnt1.m3u8';

    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(streamUrl);
      hls.attachMedia(video);
      const player = new Plyr(video, {
        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'pip', 'fullscreen'],
        settings: ['quality'],
        quality: {
          default: 'auto',
          options: ['auto']
        },
        autoplay: false
      });

      // Update quality options dynamically
      hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {
        const levels = data.levels.map((level, index) => ({
          height: level.height || 'auto',
          id: index
        }));
        const qualityOptions = levels.map(level => level.height === 'auto' ? 'auto' : level.height);
        player.quality = {
          default: 'auto',
          options: qualityOptions,
          forced: qualityOptions.length > 1,
          onChange: (quality) => {
            const levelIndex = levels.findIndex(level => level.height === quality || (quality === 'auto' && level.height === 'auto'));
            hls.currentLevel = levelIndex;
          }
        };
      });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      // Native HLS support (e.g., Safari)
      video.src = streamUrl;
      const player = new Plyr(video, {
        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'pip', 'fullscreen'],
        settings: ['quality'],
        quality: {
          default: 'auto',
          options: ['auto']
        },
        autoplay: false
      });
    } else {
      console.error('HLS is not supported in this browser');
    }

    // Render stream links
    const matchId = sessionStorage.getItem('selectedMatchId');
    const currentMatch = matches.find(match => match.id === matchId);
    const streamLinksContainer = document.getElementById('streamLinksContainer');
    if (currentMatch && currentMatch.links.length > 0) {
      streamLinksContainer.innerHTML = currentMatch.links.map(link => `
        <a href="#" class="stream-link" data-url="${link.url}" data-match-id="${currentMatch.id}">${link.title}</a>
      `).join('');
    } else {
      streamLinksContainer.innerHTML = '<p style="color: #FFFFFF; opacity: 0.7;">No stream links available</p>';
    }

    // Handle stream link clicks
    streamLinksContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('stream-link')) {
        e.preventDefault();
        const url = e.target.dataset.url;
        const matchId = e.target.dataset.matchId;
        sessionStorage.setItem('selectedStream', url);
        sessionStorage.setItem('selectedMatchId', matchId);
        window.location.reload();
      }
    });

    // Timer functions
    function getMatchStatus(startTime, endTime) {
      const now = new Date().getTime();
      if (now >= startTime && now <= endTime) return 'live';
      if (now < startTime) return 'upcoming';
      if (now > endTime) return 'recent';
      return 'unknown';
    }

    function formatLocalDateTime(ms) {
      return new Date(ms).toLocaleString('en-US', {
        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        weekday: 'short',
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true
      });
    }

    function updateTimers() {
      const timers = document.querySelectorAll('.timer');
      timers.forEach(timer => {
        const matchId = timer.id.split('-')[1];
        const match = matches.find(m => m.id === matchId);
        if (match) {
          const now = new Date().getTime();
          const status = getMatchStatus(match.startTime, match.endTime);
          if (status === 'live') {
            timer.innerHTML = '<span class="live-animation">LIVE</span>';
          } else if (status === 'upcoming') {
            const timeUntil = match.startTime - now;
            if (timeUntil > 0) {
              const hours = Math.floor(timeUntil / (1000 * 60 * 60));
              const minutes = Math.floor((timeUntil % (1000 * 60 * 60)) / (1000 * 60));
              timer.textContent = `Starts: ${formatLocalDateTime(match.startTime)} (in ${hours}h ${minutes}m)`;
            } else {
              timer.textContent = `Starts: ${formatLocalDateTime(match.startTime)}`;
            }
          } else if (status === 'recent') {
            timer.textContent = '';
          }
        }
      });
    }

    // Render suggested matches
    const suggestionsContainer = document.getElementById('suggestionsContainer');
    const suggestions = currentMatch ? matches.filter(match => match.category === currentMatch.category && match.id !== matchId) : [];
    if (!currentMatch || suggestions.length === 0) {
      suggestionsContainer.innerHTML = '<h2 style="color: #FFD700; width: 100%; text-align: center;">Suggested Matches</h2><div class="no-suggestions">No suggestions</div>';
    } else {
      suggestionsContainer.innerHTML = '<h2 style="color: #FFD700; width: 100%; text-align: center;">Suggested Matches</h2>' + suggestions.map(match => {
        const status = getMatchStatus(match.startTime, match.endTime);
        return `
          <div class="match-card">
            <div class="match-header">${match.title}</div>
            <div class="match-content">
              <img src="${match.leagueLogo}" alt="League Logo" class="league-logo">
              <div class="team-container">
                <div class="team">
                  <img src="${match.teamA.logo}" alt="${match.teamA.name}">
                  <span>${match.teamA.name}</span>
                </div>
                <div class="team">
                  <span>${match.teamB.name}</span>
                  <img src="${match.teamB.logo}" alt="${match.teamB.name}">
                </div>
              </div>
              <div class="timer" id="timer-${match.id}"></div>
              <div class="status">${status.charAt(0).toUpperCase() + status.slice(1)}</div>
              <div class="links-container">
                ${match.links.map(link => `<a href="#" class="stream-link" data-url="${link.url}" data-match-id="${match.id}">${link.title}</a>`).join('')}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Handle suggestion stream link clicks
    suggestionsContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('stream-link')) {
        e.preventDefault();
        const url = e.target.dataset.url;
        const matchId = e.target.dataset.matchId;
        sessionStorage.setItem('selectedStream', url);
        sessionStorage.setItem('selectedMatchId', matchId);
        window.location.reload();
      }
    });

    // Update timers every second
    setInterval(updateTimers, 1000);
    updateTimers();
  </script>
</body>
</html>
